<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A4Tech and Bloody List</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ... same CSS as before ... */
        
        .github-notice {
            background: #ffeb3b;
            color: #333;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }
        
        .manual-import {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <!-- ... same HTML structure as before ... -->

    <!-- Add this notice section after header -->
    <div class="container">
        <div class="github-notice" id="githubNotice">
            <h3><i class="fas fa-exclamation-triangle"></i> GitHub Pages Notice</h3>
            <p>On GitHub Pages, products.json file cannot be loaded directly. Please import your JSON file manually:</p>
            <div class="manual-import">
                <input type="file" id="jsonFileInput" accept=".json" style="display: none;">
                <button onclick="document.getElementById('jsonFileInput').click()" style="background: #00AEEF; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                    <i class="fas fa-file-import"></i> Select products.json
                </button>
                <button id="importJsonBtn" style="background: #25D366; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-upload"></i> Import Products
                </button>
                <span id="fileName" style="margin-left: 10px; color: #666;">No file selected</span>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const productsGrid = document.getElementById('productsGrid');
        const productsList = document.getElementById('productsList');
        const categoriesContainer = document.getElementById('categories');
        const searchBox = document.getElementById('searchBox');
        const cartIcon = document.getElementById('cartIcon');
        const cartCount = document.getElementById('cartCount');
        const cartPopup = document.getElementById('cartPopup');
        const closeCart = document.getElementById('closeCart');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const overlay = document.getElementById('overlay');
        const gridViewBtn = document.getElementById('gridViewBtn');
        const listViewBtn = document.getElementById('listViewBtn');
        const floatingCartBtn = document.getElementById('floatingCartBtn');
        const floatingCartTotal = document.getElementById('floatingCartTotal');
        const githubNotice = document.getElementById('githubNotice');
        const jsonFileInput = document.getElementById('jsonFileInput');
        const importJsonBtn = document.getElementById('importJsonBtn');
        const fileName = document.getElementById('fileName');

        // Cart state
        let products = [];
        let cart = [];
        let currentCategory = 'All';
        let currentView = 'grid';
        let currentBrand = null;

        // Try to load from localStorage first (for returning visitors)
        function loadFromLocalStorage() {
            const storedProducts = localStorage.getItem('a4techBloodyProducts');
            if (storedProducts) {
                try {
                    products = JSON.parse(storedProducts);
                    console.log('Products loaded from localStorage:', products.length);
                    githubNotice.style.display = 'none';
                    showMessage(`Welcome back! Loaded ${products.length} products from your previous session.`, 'success');
                    return true;
                } catch (error) {
                    console.error('Error loading from localStorage:', error);
                }
            }
            return false;
        }

        // Try to load from JSON file (works only on local server, not GitHub Pages)
        async function loadFromJSON() {
            try {
                const response = await fetch('products.json');
                if (response.ok) {
                    products = await response.json();
                    console.log('Products loaded from JSON file:', products.length);
                    
                    // Save to localStorage for future visits
                    localStorage.setItem('a4techBloodyProducts', JSON.stringify(products));
                    githubNotice.style.display = 'none';
                    showMessage(`Successfully loaded ${products.length} products from JSON file`, 'success');
                    return true;
                }
            } catch (error) {
                console.log('Cannot load from JSON file (GitHub Pages restriction)');
            }
            return false;
        }

        // Manual JSON file import
        function setupManualImport() {
            jsonFileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    fileName.textContent = file.name;
                }
            });

            importJsonBtn.addEventListener('click', function() {
                const file = jsonFileInput.files[0];
                
                if (!file) {
                    showMessage('Please select a JSON file first', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedProducts = JSON.parse(e.target.result);
                        if (Array.isArray(importedProducts)) {
                            products = importedProducts;
                            
                            // Save to localStorage
                            localStorage.setItem('a4techBloodyProducts', JSON.stringify(products));
                            
                            renderProducts();
                            githubNotice.style.display = 'none';
                            showMessage(`Successfully imported ${products.length} products!`, 'success');
                        } else {
                            showMessage('Invalid JSON format. File should contain an array of products.', 'error');
                        }
                    } catch (error) {
                        showMessage('Error parsing JSON file. Please check the file format.', 'error');
                    }
                };
                reader.readAsText(file);
            });
        }

        // Load products with fallback
        async function loadProducts() {
            console.log('Loading products...');
            
            // First try localStorage
            if (loadFromLocalStorage()) {
                return;
            }
            
            // Then try JSON file
            if (await loadFromJSON()) {
                return;
            }
            
            // If both fail, show manual import notice
            console.log('No products found. Showing manual import option.');
            githubNotice.style.display = 'block';
            products = [];
        }

        // Initialize the app
        async function init() {
            console.log('Initializing app...');
            setupManualImport();
            await loadProducts();
            renderCategories();
            renderProducts();
            setupEventListeners();
            updateCartUI();
        }

        // ... rest of the functions (renderCategories, renderProducts, etc.) remain the same ...
        // Render categories
        function renderCategories() {
            const a4techSubcategories = ['Keyboard', 'Mouse', 'Webcam', 'Audio', 'Others'];
            const bloodySubcategories = ['Keyboard', 'Mouse', 'Mousepad', 'Audio', 'Others'];
            
            let categoriesHTML = '';
            
            // All button
            categoriesHTML += `<button class="category-btn brand-btn active" data-category="All">All Products</button>`;
            
            // A4Tech brand button
            categoriesHTML += `<button class="category-btn brand-btn" data-category="A4Tech">
                <img src="https://a4tech.com.pk/cdn/shop/files/Asset_2_2x_a2c2a49b-fe13-4968-9b0f-1912f73772ed_170x.png?v=1698154812" alt="A4Tech">
                A4Tech
            </button>`;
            
            // Bloody brand button
            categoriesHTML += `<button class="category-btn brand-btn" data-category="Bloody">
                <img src="https://lh3.googleusercontent.com/proxy/SN4kpKa8Sv67UxZxjo3XYtPCkokXimJO_6NwqyO9V1DiyUYSO7sSJTV6nCaSZ8QeSW_AvuOWpjfzl3fXpW0yphw" alt="Bloody">
                Bloody
            </button>`;
            
            // A4Tech subcategories (hidden by default)
            a4techSubcategories.forEach(sub => {
                categoriesHTML += `<button class="category-btn subcategory" data-category="A4Tech-${sub}">${sub}</button>`;
            });
            
            // Bloody subcategories (hidden by default)
            bloodySubcategories.forEach(sub => {
                categoriesHTML += `<button class="category-btn subcategory" data-category="Bloody-${sub}">${sub}</button>`;
            });
            
            categoriesContainer.innerHTML = categoriesHTML;
        }

        // Show/hide subcategories based on selected brand
        function toggleSubcategories(brand) {
            // Hide all subcategories
            document.querySelectorAll('.subcategory').forEach(btn => {
                btn.classList.remove('visible');
            });
            
            // Show subcategories for selected brand
            if (brand && brand !== 'All') {
                document.querySelectorAll(`.subcategory[data-category^="${brand}-"]`).forEach(btn => {
                    btn.classList.add('visible');
                });
            }
        }

        // Render products based on current category and search
        function renderProducts() {
            console.log('Rendering products, total:', products.length);
            
            let filteredProducts = products;
            
            // Filter by category
            if (currentCategory !== 'All') {
                if (currentCategory.includes('-')) {
                    const [brand, category] = currentCategory.split('-');
                    filteredProducts = products.filter(product => 
                        product.brand === brand && product.category === category
                    );
                } else {
                    filteredProducts = products.filter(product => 
                        product.brand === currentCategory
                    );
                }
            }
            
            // Filter by search term
            const searchTerm = searchBox.value.toLowerCase();
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm)
                );
            }
            
            // Render products in grid view
            let gridHTML = '';
            if (filteredProducts.length === 0) {
                gridHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-box-open" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
                        <h3>No products found</h3>
                        <p>No products available. Please import products using the option above.</p>
                    </div>
                `;
            } else {
                filteredProducts.forEach(product => {
                    gridHTML += `
                        <div class="product-card">
                            <img src="${product.image}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/300x200?text=Image+Not+Found'">
                            <div class="product-info">
                                <h3 class="product-title">${product.name}</h3>
                                <p class="product-description">${product.description}</p>
                                <div class="product-price">Rs. ${product.price}</div>
                                <button class="add-to-cart" data-id="${product.id}">Add to Cart</button>
                            </div>
                        </div>
                    `;
                });
            }
            productsGrid.innerHTML = gridHTML;
            
            // Render products in list view
            let listHTML = '';
            if (filteredProducts.length === 0) {
                listHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-box-open" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
                        <h3>No products found</h3>
                        <p>No products available. Please import products using the option above.</p>
                    </div>
                `;
            } else {
                filteredProducts.forEach(product => {
                    listHTML += `
                        <div class="product-item">
                            <img src="${product.image}" alt="${product.name}" class="product-image" style="width: 100px; height: 100px; margin-right: 15px;" onerror="this.src='https://via.placeholder.com/100x100?text=Image+Not+Found'">
                            <div class="product-item-info">
                                <h3 class="product-item-title">${product.name}</h3>
                                <p class="product-item-description">${product.description}</p>
                                <div class="product-item-price">Rs. ${product.price}</div>
                            </div>
                            <div class="product-item-action">
                                <button class="add-to-cart-list" data-id="${product.id}">Add to Cart</button>
                            </div>
                        </div>
                    `;
                });
            }
            productsList.innerHTML = listHTML;
            
            // Add event listeners to add to cart buttons
            document.querySelectorAll('.add-to-cart, .add-to-cart-list').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    addToCart(productId);
                });
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Category buttons
            document.querySelectorAll('.category-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    
                    // Remove active class from all buttons
                    document.querySelectorAll('.category-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Handle brand buttons
                    if (category === 'All' || category === 'A4Tech' || category === 'Bloody') {
                        currentBrand = category === 'All' ? null : category;
                        toggleSubcategories(currentBrand);
                        
                        // If it's a brand button, set the category to the brand
                        if (category !== 'All') {
                            currentCategory = category;
                        } else {
                            currentCategory = 'All';
                        }
                    } else {
                        // It's a subcategory button
                        currentCategory = category;
                    }
                    
                    // Re-render products
                    renderProducts();
                });
            });
            
            // Search box
            searchBox.addEventListener('input', renderProducts);
            
            // View toggle buttons
            gridViewBtn.addEventListener('click', function() {
                if (currentView !== 'grid') {
                    currentView = 'grid';
                    gridViewBtn.classList.add('active');
                    listViewBtn.classList.remove('active');
                    productsGrid.style.display = 'grid';
                    productsList.style.display = 'none';
                }
            });
            
            listViewBtn.addEventListener('click', function() {
                if (currentView !== 'list') {
                    currentView = 'list';
                    listViewBtn.classList.add('active');
                    gridViewBtn.classList.remove('active');
                    productsList.style.display = 'flex';
                    productsGrid.style.display = 'none';
                }
            });
            
            // Cart icon
            cartIcon.addEventListener('click', openCart);
            
            // Close cart
            closeCart.addEventListener('click', closeCartPopup);
            
            // Overlay
            overlay.addEventListener('click', closeCartPopup);
            
            // Floating cart button
            floatingCartBtn.addEventListener('click', openCart);
            
            // Checkout button
            checkoutBtn.addEventListener('click', checkout);
        }

        // Add product to cart
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // Ensure price is a valid number
            let price = product.price;
            if (typeof price === 'string') {
                price = price.replace(/[^\d.]/g, '');
            }
            price = parseFloat(price);
            if (isNaN(price)) {
                console.warn(`Invalid price for product ${product.name}: ${product.price}, setting to 0`);
                price = 0;
            }
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: price,
                    image: product.image,
                    quantity: 1
                });
            }
            
            updateCartUI();
            
            // Show success message
            showMessage(`${product.name} added to cart!`, 'success');
        }

        // Remove product from cart
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartUI();
        }

        // Update cart quantity
        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (!item) return;
            
            item.quantity += change;
            
            if (item.quantity <= 0) {
                removeFromCart(productId);
            } else {
                updateCartUI();
            }
        }

        // Update cart UI
        function updateCartUI() {
            // Update cart count
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            cartCount.textContent = totalItems;
            
            // Update cart items
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>Your cart is empty</h3>
                        <p>Add some products to your cart</p>
                    </div>
                `;
                cartTotal.textContent = 'Rs. 0.00';
                floatingCartTotal.textContent = 'Rs. 0.00';
            } else {
                let cartHTML = '';
                let total = 0;
                
                cart.forEach(item => {
                    // Ensure item price is a valid number
                    let itemPrice = item.price;
                    if (typeof itemPrice === 'string') {
                        itemPrice = itemPrice.replace(/[^\d.]/g, '');
                    }
                    itemPrice = parseFloat(itemPrice);
                    if (isNaN(itemPrice)) {
                        itemPrice = 0;
                    }
                    
                    const itemTotal = itemPrice * item.quantity;
                    total += itemTotal;
                    
                    cartHTML += `
                        <div class="cart-item">
                            <img src="${item.image}" alt="${item.name}" class="cart-item-image" onerror="this.src='https://via.placeholder.com/80x80?text=Image+Not+Found'">
                            <div class="cart-item-details">
                                <h4 class="cart-item-title">${item.name}</h4>
                                <div class="cart-item-price">Rs. ${itemPrice}</div>
                                <div class="cart-item-quantity">
                                    <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="quantity">${item.quantity}</span>
                                    <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                    <button class="remove-item" onclick="removeFromCart(${item.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                cartItems.innerHTML = cartHTML;
                
                // Ensure total is a valid number
                if (isNaN(total)) {
                    console.error('Total is NaN, resetting to 0');
                    total = 0;
                }
                
                cartTotal.textContent = `Rs. ${total.toFixed(2)}`;
                floatingCartTotal.textContent = `Rs. ${total.toFixed(2)}`;
            }
        }

        // Open cart
        function openCart() {
            cartPopup.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close cart
        function closeCartPopup() {
            cartPopup.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Checkout via WhatsApp
        function checkout() {
            if (cart.length === 0) {
                showMessage('Your cart is empty!', 'error');
                return;
            }
            
            let message = "Hello! I'd like to place an order:\n\n";
            let total = 0;
            
            cart.forEach(item => {
                // Ensure item price is valid
                let itemPrice = item.price;
                if (typeof itemPrice === 'string') {
                    itemPrice = itemPrice.replace(/[^\d.]/g, '');
                }
                itemPrice = parseFloat(itemPrice);
                if (isNaN(itemPrice)) itemPrice = 0;
                
                const itemTotal = itemPrice * item.quantity;
                total += itemTotal;
                message += `- ${item.name} (x${item.quantity}) - Rs. ${itemTotal.toFixed(2)}\n`;
            });
            
            // Ensure total is valid
            if (isNaN(total)) total = 0;
            
            message += `\nTotal: Rs. ${total.toFixed(2)}`;
            
            // Encode the message for URL
            const encodedMessage = encodeURIComponent(message);
            
            // Replace with your WhatsApp number
            const phoneNumber = "1234567890";
            
            // Open WhatsApp with the message
            window.open(`https://wa.me/${phoneNumber}?text=${encodedMessage}`, '_blank');
        }

        // Show message
        function showMessage(text, type) {
            // Remove existing messages
            const existingMessage = document.querySelector('.success-message, .error-message, .info-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // Create new message
            const message = document.createElement('div');
            message.className = type === 'success' ? 'success-message' : type === 'info' ? 'info-message' : 'error-message';
            message.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'info' ? 'info' : 'exclamation-triangle'}"></i> ${text}`;
            
            // Insert message after header
            const container = document.querySelector('.container');
            container.insertBefore(message, container.firstChild);
            
            // Remove message after 5 seconds
            setTimeout(() => {
                if (message.parentNode) {
                    message.remove();
                }
            }, 5000);
        }

        // Make functions globally accessible for onclick events
        window.updateQuantity = updateQuantity;
        window.removeFromCart = removeFromCart;

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
