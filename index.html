<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A4Tech & Bloody Store</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* --- SAME DESIGN AS BEFORE --- */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Verdana,sans-serif;}
body{background:#f5f5f5;color:#333;}
header{background:#00AEEF;color:white;padding:15px 0;box-shadow:0 4px 12px rgba(0,0,0,0.1);position:sticky;top:0;z-index:100;}
.container{max-width:1200px;margin:0 auto;padding:0 20px;}
.header-content{display:flex;justify-content:space-between;align-items:center;}
h1{font-size:1.8rem;font-weight:600;}
.cart-icon{position:relative;font-size:1.5rem;cursor:pointer;padding:10px;border-radius:50%;background:rgba(255,255,255,0.2);width:50px;height:50px;display:flex;align-items:center;justify-content:center;transition:.3s;}
.cart-icon:hover{background:rgba(255,255,255,0.3);transform:scale(1.05);}
.cart-count{position:absolute;top:-5px;right:-5px;background:#ff4757;color:white;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:.8rem;font-weight:bold;}
.controls{display:flex;justify-content:space-between;margin:20px 0;background:white;padding:15px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.05);}
.view-toggle{display:flex;gap:10px;}
.view-btn{padding:8px 15px;border:1px solid #ddd;background:white;border-radius:5px;cursor:pointer;transition:.3s;}
.view-btn.active{background:#25D366;color:white;border-color:#25D366;}
.search-box{padding:8px 15px;border:1px solid #ddd;border-radius:5px;width:250px;}
.categories{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px;}
.category-btn{padding:8px 15px;border:1px solid #ddd;background:white;border-radius:5px;cursor:pointer;transition:.3s;}
.category-btn.active{background:#2575fc;color:white;border-color:#2575fc;}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:25px;margin-bottom:40px;}
.product-card{background:white;border-radius:10px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,0.05);transition:.3s;display:flex;flex-direction:column;}
.product-card:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(0,0,0,0.1);}
.product-image{height:250px;width:100%;object-fit:cover;}
.product-info{padding:20px;flex:1;display:flex;flex-direction:column;}
.product-title{font-size:1.2rem;margin-bottom:10px;}
.product-price{font-size:1.3rem;font-weight:700;color:#25D366;margin-bottom:15px;}
.add-to-cart{background:#25D366;color:white;border:none;padding:10px 15px;border-radius:5px;cursor:pointer;width:100%;font-weight:600;transition:.3s;}
.add-to-cart:hover{background:#128C7E;}
.out-of-stock{background:#ff4757;color:white;border:none;padding:10px 15px;border-radius:5px;width:100%;font-weight:600;}
.cart-popup{position:fixed;top:0;right:-400px;width:100%;max-width:380px;height:100vh;background:white;box-shadow:-5px 0 15px rgba(0,0,0,0.1);transition:right .4s;z-index:1000;display:flex;flex-direction:column;}
.cart-popup.active{right:0;}
.cart-header{padding:20px;background:#25D366;color:white;display:flex;justify-content:space-between;align-items:center;}
.close-cart{background:none;border:none;color:white;font-size:1.5rem;cursor:pointer;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:999;display:none;}
.overlay.active{display:block;}
.floating-cart-btn{position:fixed;right:20px;bottom:20px;background:#25D366;color:white;border:none;border-radius:50px;padding:15px 20px;box-shadow:0 5px 15px rgba(0,0,0,0.2);cursor:pointer;display:flex;align-items:center;gap:10px;font-weight:600;transition:.3s;}
.floating-cart-btn:hover{background:#128C7E;transform:scale(1.05);}
.success-message,.error-message{padding:10px;margin:10px 0;border-radius:5px;text-align:center;color:white;}
.success-message{background:#1dd1a1;}
.error-message{background:#ff6b6b;}
</style>
</head>
<body>
<header>
  <div class="container header-content">
    <h1>A4Tech & Bloody Store</h1>
    <div style="display:flex;align-items:center;gap:15px;">
      <button id="refreshBtn" style="background:white;color:#00AEEF;border:none;padding:8px 12px;border-radius:5px;cursor:pointer;font-weight:600;">
        <i class="fas fa-sync-alt"></i> Refresh
      </button>
      <div class="cart-icon" id="cartIcon"><i class="fas fa-shopping-cart"></i><div class="cart-count" id="cartCount">0</div></div>
    </div>
  </div>
</header>

<div class="container">
  <div class="controls">
    <div class="view-toggle">
      <button class="view-btn active" id="gridViewBtn"><i class="fas fa-th"></i> Grid</button>
      <button class="view-btn" id="listViewBtn"><i class="fas fa-list"></i> List</button>
    </div>
    <input type="text" class="search-box" id="searchBox" placeholder="Search products...">
  </div>

  <div class="categories" id="categories"></div>
  <div class="products-grid" id="productsGrid"></div>
</div>

<div class="overlay" id="overlay"></div>
<div class="cart-popup" id="cartPopup">
  <div class="cart-header">
    <h2>Your Cart</h2>
    <button class="close-cart" id="closeCart"><i class="fas fa-times"></i></button>
  </div>
  <div id="cartItems" style="flex:1;overflow-y:auto;padding:20px;"></div>
  <div style="padding:20px;border-top:1px solid #eee;">
    <div style="display:flex;justify-content:space-between;font-weight:700;margin-bottom:10px;">
      <span>Total:</span><span id="cartTotal">Rs. 0</span>
    </div>
    <button id="checkoutBtn" class="add-to-cart"><i class="fab fa-whatsapp"></i> Checkout via WhatsApp</button>
  </div>
</div>

<button class="floating-cart-btn" id="floatingCartBtn">
  <i class="fas fa-shopping-cart"></i>
  <span id="floatingCartTotal">Rs. 0</span>
</button>

<script>
// ======== CONFIG ========
const DATA_FILE_URL = './products.json';
const PHONE_NUMBER = '923332200318';

// ======== DOM ========
const grid = document.getElementById('productsGrid');
const cartPopup = document.getElementById('cartPopup');
const overlay = document.getElementById('overlay');
const cartItems = document.getElementById('cartItems');
const cartCount = document.getElementById('cartCount');
const cartTotal = document.getElementById('cartTotal');
const floatingTotal = document.getElementById('floatingCartTotal');
const refreshBtn = document.getElementById('refreshBtn');
const categories = document.getElementById('categories');
const searchBox = document.getElementById('searchBox');

// ======== DATA ========
let products = [];
let cart = [];

// ======== INIT ========
document.addEventListener('DOMContentLoaded', async () => {
  await loadProducts();
  setupEvents();
});

// ======== LOAD PRODUCTS ========
async function loadProducts(){
  try{
    const response = await fetch(`${DATA_FILE_URL}?t=${Date.now()}`);
    const data = await response.json();
    products = data.products;
    renderCategories();
    renderProducts(products);
  }catch(e){
    showMessage('Failed to load products.json','error');
  }
}

// ======== RENDER ========
function renderCategories(){
  const brands = [...new Set(products.map(p=>p.brand))];
  const cats = [...new Set(products.map(p=>p.category))];
  let html = `<button class="category-btn active" data-filter="all">All</button>`;
  brands.forEach(b=> html += `<button class="category-btn" data-filter="${b}">${b}</button>`);
  cats.forEach(c=> html += `<button class="category-btn" data-filter="${c}">${c}</button>`);
  categories.innerHTML = html;
  document.querySelectorAll('.category-btn').forEach(btn=>{
    btn.onclick = ()=>{document.querySelectorAll('.category-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');filterProducts(btn.dataset.filter)};
  });
}

function renderProducts(list){
  grid.innerHTML = '';
  list.forEach(p=>{
    const disabled = p.stock==='no';
    grid.innerHTML += `
      <div class="product-card">
        <img src="${p.image}" onerror="this.src='https://via.placeholder.com/250x250?text=No+Image'" class="product-image">
        <div class="product-info">
          <h3 class="product-title">${p.name}</h3>
          <p>${p.description}</p>
          <div class="product-price">Rs. ${p.price}</div>
          <button class="${disabled?'out-of-stock':'add-to-cart'}" ${disabled?'disabled':''} onclick="addToCart(${p.id})">
            ${disabled?'Out of Stock':'Add to Cart'}
          </button>
        </div>
      </div>`;
  });
}

// ======== FILTER ========
function filterProducts(filter){
  let list = products;
  if(filter!=='all') list = products.filter(p=>p.brand===filter||p.category===filter);
  const term = searchBox.value.toLowerCase();
  if(term) list = list.filter(p=>p.name.toLowerCase().includes(term));
  renderProducts(list);
}

// ======== CART ========
function addToCart(id){
  const item = products.find(p=>p.id===id);
  if(!item) return;
  const existing = cart.find(c=>c.id===id);
  if(existing) existing.qty++;
  else cart.push({...item,qty:1});
  updateCartUI();
  showMessage(`${item.name} added to cart!`,'success');
}

function updateCartUI(){
  let total=0;
  cartItems.innerHTML='';
  cart.forEach(it=>{
    const sub=it.qty*it.price;
    total+=sub;
    cartItems.innerHTML+=`
      <div style="display:flex;margin-bottom:15px;">
        <img src="${it.image}" width="70" height="70" style="border-radius:5px;margin-right:10px;">
        <div style="flex:1;">
          <h4>${it.name}</h4>
          <p>Rs. ${it.price} x ${it.qty}</p>
          <div>
            <button onclick="changeQty(${it.id},-1)">-</button>
            <button onclick="changeQty(${it.id},1)">+</button>
            <button onclick="removeFromCart(${it.id})">ðŸ—‘</button>
          </div>
        </div>
      </div>`;
  });
  cartCount.textContent=cart.length;
  cartTotal.textContent=`Rs. ${total}`;
  floatingTotal.textContent=`Rs. ${total}`;
}

function changeQty(id,chg){
  const it=cart.find(i=>i.id===id);
  if(!it) return;
  it.qty+=chg;
  if(it.qty<=0) cart=cart.filter(i=>i.id!==id);
  updateCartUI();
}

function removeFromCart(id){
  cart=cart.filter(i=>i.id!==id);
  updateCartUI();
}

function checkout(){
  if(cart.length===0){showMessage('Cart empty!','error');return;}
  let msg="Hello! I'd like to order:\n";
  let total=0;
  cart.forEach(i=>{msg+=`- ${i.name} x${i.qty} = Rs.${i.qty*i.price}\n`;total+=i.qty*i.price;});
  msg+=`\nTotal: Rs.${total}`;
  window.open(`https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(msg)}`,'_blank');
}

// ======== MISC ========
function setupEvents(){
  document.getElementById('cartIcon').onclick=()=>toggleCart(true);
  document.getElementById('closeCart').onclick=()=>toggleCart(false);
  document.getElementById('floatingCartBtn').onclick=()=>toggleCart(true);
  overlay.onclick=()=>toggleCart(false);
  refreshBtn.onclick=()=>loadProducts();
  document.getElementById('checkoutBtn').onclick=checkout;
  searchBox.oninput=()=>filterProducts(document.querySelector('.category-btn.active').dataset.filter);
}

function toggleCart(show){
  cartPopup.classList.toggle('active',show);
  overlay.classList.toggle('active',show);
  document.body.style.overflow=show?'hidden':'auto';
}

function showMessage(msg,type){
  const div=document.createElement('div');
  div.className=type==='success'?'success-message':'error-message';
  div.textContent=msg;
  document.body.prepend(div);
  setTimeout(()=>div.remove(),3000);
}
</script>
</body>
</html>
