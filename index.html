<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Online Store</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6fa; margin:0; }
    header { background:#007bff; color:white; text-align:center; padding:15px; font-size:1.5rem; font-weight:bold; }
    .container { max-width:1100px; margin:20px auto; padding:0 15px; }
    #product-list { display:grid; grid-template-columns:repeat(auto-fit, minmax(240px, 1fr)); gap:15px; }
    .product { background:white; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); padding:10px; text-align:center; display:flex; flex-direction:column; }
    .product img { width:100%; height:180px; object-fit:cover; border-radius:10px; }
    .product h3 { margin:10px 0 5px; font-size:1.1rem; }
    .product p { margin:5px 0; color:#555; }
    .price { color:#25D366; font-weight:bold; margin:8px 0; }
    .btn { background:#007bff; color:white; border:none; padding:8px 10px; border-radius:6px; cursor:pointer; margin-top:auto; }
    .btn:hover { background:#0056b3; }
    #cart { background:white; padding:15px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); margin-top:20px; }
    ul { list-style:none; padding:0; margin:0; }
    li { padding:5px 0; border-bottom:1px solid #eee; display:flex; justify-content:space-between; }
    #checkout { background:#25D366; color:white; border:none; padding:10px; border-radius:6px; cursor:pointer; margin-top:10px; width:100%; }
    #checkout:hover { background:#128C7E; }
  </style>
</head>
<body>
  <header>🛒 My Store</header>
  <div class="container">
    <div id="product-list">Loading products...</div>
    <div id="cart">
      <h3>Your Cart</h3>
      <ul id="cart-items"></ul>
      <p><strong>Total:</strong> Rs <span id="total">0</span></p>
      <button id="checkout">Checkout with WhatsApp</button>
    </div>
  </div>

  <script>
    const PRODUCTS_FILE = 'products.json';
    const WHATSAPP_NUMBER = '923001234567'; // apna number likho

    let products = [];
    let cart = [];

    async function loadProducts() {
      try {
        const res = await fetch(PRODUCTS_FILE + '?t=' + Date.now());
        if (!res.ok) throw new Error('Failed to load JSON');
        const data = await res.json();
        products = data.products || data;
        displayProducts();
      } catch (err) {
        document.getElementById('product-list').innerHTML = '<p style="color:red;">Error loading products.json</p>';
        console.error(err);
      }
    }

    function displayProducts() {
      const list = document.getElementById('product-list');
      list.innerHTML = '';
      products.forEach(p => {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
          <img src="${p.image || 'https://via.placeholder.com/250x200'}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p>${p.description || ''}</p>
          <div class="price">Rs ${p.price}</div>
          <button class="btn" onclick='addToCart(${JSON.stringify(p)})'>Add to Cart</button>
        `;
        list.appendChild(div);
      });
    }

    function addToCart(p) {
      const existing = cart.find(i => i.name === p.name);
      if (existing) existing.qty++;
      else cart.push({ ...p, qty: 1 });
      updateCart();
    }

    function updateCart() {
      const ul = document.getElementById('cart-items');
      const total = document.getElementById('total');
      ul.innerHTML = '';
      let sum = 0;
      cart.forEach(item => {
        const li = document.createElement('li');
        li.innerHTML = `<span>${item.name} x${item.qty}</span><span>Rs ${item.price * item.qty}</span>`;
        ul.appendChild(li);
        sum += item.price * item.qty;
      });
      total.textContent = sum;
    }

    document.getElementById('checkout').addEventListener('click', () => {
      if (cart.length === 0) return alert('Your cart is empty!');
      let msg = '🛍 *Order Details:*\n';
      let total = 0;
      cart.forEach(i => {
        msg += `• ${i.name} x${i.qty} = Rs ${i.price * i.qty}\n`;
        total += i.price * i.qty;
      });
      msg += `\n*Total:* Rs ${total}\n\nPlease confirm my order.`;
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
    });

    loadProducts();
  </script>
</body>
</html>
